<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.culture.demo.mapper.BranchInfoMapper">
	
	<!--대분류로 소분류 지점 목록 조회
	public List<BranchDTO> selectBranchList(int branch_tp_id); -->
	<select id="selectBranchList" resultType="com.culture.demo.domain.BranchDTO">
	SELECT branch_id, branch_nm 
	FROM branch 
	WHERE branch_tp_id = #{branch_tp_id}
	</select>
	

	<!--소분류 클릭하면 지점 정보 조회
	public List<BranchDTO> selectBranchInfo(int branch_id); -->
	<select id="selectBranchInfo" resultType="com.culture.demo.domain.BranchDTO">
	SELECT b.branch_id, p.branch_tp, b.branch_nm, b.branch_addr, b.tel, b.lat, b.lng, i.branch_img,
		(SELECT MAX(c1.classroom_nm) 
		 FROM classroom c1 
		 WHERE c1.branch_id = b.branch_id) AS classroom_nm
	FROM branch_type p JOIN branch b ON p.branch_tp_id = b.branch_tp_id
	JOIN branch_image i ON b.branch_id = i.branch_id
	WHERE b.branch_id = #{b.branch_id}	
	</select>

</mapper>